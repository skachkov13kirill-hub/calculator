<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ö–æ–Ω—Ç—Ä–æ–ª—å - –î–∞—à–±–æ—Ä–¥ v4.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 14px; }
        
        /* TABS */
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-size: 14px;
        }
        .tab:hover { background: #e9ecef; }
        .tab.active {
            color: #667eea;
            background: white;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        .tab-content.active { display: block; }
        
        /* MONTH SELECTOR */
        .month-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .month-selector select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        .month-selector button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* NETWORK OVERVIEW */
        .network-overview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .network-overview h2 { font-size: 20px; margin-bottom: 20px; text-align: center; }
        .overview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-card .label { font-size: 12px; opacity: 0.9; margin-bottom: 8px; }
        .stat-card .value { font-size: 28px; font-weight: bold; }
        .stat-card .subtext { font-size: 11px; opacity: 0.8; margin-top: 5px; }
        .progress-bar-container {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            height: 30px;
            overflow: hidden;
            position: relative;
        }
        .progress-bar {
            background: linear-gradient(90deg, #56ab2f 0%, #a8e063 100%);
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        /* FILIALS GRID */
        .filials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .filial-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        .filial-card:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        .filial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }
        .filial-name {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        .filial-rank {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .filial-metrics {
            margin-bottom: 15px;
        }
        .metric-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
        }
        .metric-label {
            color: #666;
            font-weight: 600;
        }
        .metric-value {
            font-weight: bold;
            color: #333;
        }
        .metric-plan {
            color: #999;
            font-size: 11px;
        }
        .performance-indicator {
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            margin-top: 10px;
        }
        .performance-indicator.high { background: #d4edda; color: #155724; }
        .performance-indicator.medium { background: #fff3cd; color: #856404; }
        .performance-indicator.low { background: #f8d7da; color: #721c24; }
        
        .clients-info {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 12px;
        }
        .clients-info div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .forecast-box {
            background: #fff;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin-top: 10px;
            font-size: 12px;
        }
        .forecast-box .title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #667eea;
        }
        
        /* LOADING */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ERROR */
        .error-message {
            background: #fee;
            border-left: 4px solid #e74c3c;
            padding: 20px;
            border-radius: 8px;
            color: #c0392b;
            margin: 20px 0;
        }
        
        /* BUTTONS */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .action-button {
            padding: 12px;
            font-size: 13px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .refresh-button {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .version-badge {
            text-align: center;
            padding: 15px;
            font-size: 11px;
            color: #999;
        }
        
        /* CHARTS PLACEHOLDER */
        .chart-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ö–æ–Ω—Ç—Ä–æ–ª—å & –î–∞—à–±–æ—Ä–¥</h1>
            <p>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–µ—Ç–∏ –∏–∑ 9 –∞—Ç–µ–ª—å–µ</p>
        </div>
        
        <!-- TABS -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('overview')">üìä –û–±–∑–æ—Ä —Å–µ—Ç–∏</div>
            <div class="tab" onclick="switchTab('filials')">üè™ –ü–æ —Ñ–∏–ª–∏–∞–ª–∞–º</div>
            <div class="tab" onclick="switchTab('analytics')">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
        </div>
        
        <!-- OVERVIEW TAB -->
        <div class="tab-content active" id="overview-tab">
            <div class="month-selector">
                <div>
                    <label style="font-weight: 600; margin-right: 10px;">–ú–µ—Å—è—Ü:</label>
                    <select id="monthSelect" onchange="loadData()">
                        <option value="1">–Ø–Ω–≤–∞—Ä—å</option>
                        <option value="2">–§–µ–≤—Ä–∞–ª—å</option>
                        <option value="3">–ú–∞—Ä—Ç</option>
                        <option value="4">–ê–ø—Ä–µ–ª—å</option>
                        <option value="5">–ú–∞–π</option>
                        <option value="6">–ò—é–Ω—å</option>
                        <option value="7">–ò—é–ª—å</option>
                        <option value="8">–ê–≤–≥—É—Å—Ç</option>
                        <option value="9">–°–µ–Ω—Ç—è–±—Ä—å</option>
                        <option value="10">–û–∫—Ç—è–±—Ä—å</option>
                        <option value="11">–ù–æ—è–±—Ä—å</option>
                        <option value="12">–î–µ–∫–∞–±—Ä—å</option>
                    </select>
                </div>
                <button onclick="loadData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            </div>
            
            <div id="overview-loading" class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
            </div>
            
            <div id="overview-content" style="display: none;">
                <div class="network-overview">
                    <h2>üè¢ –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ç–∏</h2>
                    <div class="overview-stats">
                        <div class="stat-card">
                            <div class="label">–ê—Ç–µ–ª—å–µ</div>
                            <div class="value" id="totalAtelie">‚Äî</div>
                            <div class="subtext" id="totalAteliePlan">‚Äî</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">–•–∏–º—á–∏—Å—Ç–∫–∞</div>
                            <div class="value" id="totalHimchistka">‚Äî</div>
                            <div class="subtext" id="totalHimchistkaPlan">‚Äî</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">–í—Å–µ–≥–æ</div>
                            <div class="value" id="totalRevenue">‚Äî</div>
                            <div class="subtext" id="totalRevenuePlan">‚Äî</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">–ö–ª–∏–µ–Ω—Ç—ã</div>
                            <div class="value" id="totalClients">‚Äî</div>
                            <div class="subtext" id="avgCheck">‚Äî</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">–ü—Ä–∏–±—ã–ª—å</div>
                            <div class="value" id="totalProfit">‚Äî</div>
                            <div class="subtext">—á–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</div>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="totalProgress" style="width: 0%">0%</div>
                    </div>
                </div>
            </div>
            
            <div id="overview-error" style="display: none;"></div>
        </div>
        
        <!-- FILIALS TAB -->
        <div class="tab-content" id="filials-tab">
            <div class="month-selector">
                <div>
                    <label style="font-weight: 600; margin-right: 10px;">–ú–µ—Å—è—Ü:</label>
                    <select id="monthSelectFilials" onchange="loadData()">
                        <option value="1">–Ø–Ω–≤–∞—Ä—å</option>
                        <option value="2">–§–µ–≤—Ä–∞–ª—å</option>
                        <option value="3">–ú–∞—Ä—Ç</option>
                        <option value="4">–ê–ø—Ä–µ–ª—å</option>
                        <option value="5">–ú–∞–π</option>
                        <option value="6">–ò—é–Ω—å</option>
                        <option value="7">–ò—é–ª—å</option>
                        <option value="8">–ê–≤–≥—É—Å—Ç</option>
                        <option value="9">–°–µ–Ω—Ç—è–±—Ä—å</option>
                        <option value="10">–û–∫—Ç—è–±—Ä—å</option>
                        <option value="11">–ù–æ—è–±—Ä—å</option>
                        <option value="12">–î–µ–∫–∞–±—Ä—å</option>
                    </select>
                </div>
                <button onclick="loadData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            </div>
            
            <div id="filials-loading" class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤...</p>
            </div>
            
            <div id="filials-content" style="display: none;">
                <div class="filials-grid" id="filialsGrid"></div>
            </div>
            
            <div id="filials-error" style="display: none;"></div>
        </div>
        
        <!-- ANALYTICS TAB -->
        <div class="tab-content" id="analytics-tab">
            <h2 style="margin-bottom: 20px;">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏</h2>
            
            <div class="chart-container">
                <div>
                    <h3 style="margin-bottom: 10px;">–ì—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
                    <p>–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
                    <p style="font-size: 11px; margin-top: 10px;">–ó–¥–µ—Å—å –±—É–¥—É—Ç –≥—Ä–∞—Ñ–∏–∫–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–µ—Å—è—Ü–µ–≤</p>
                </div>
            </div>
            
            <div class="chart-container">
                <div>
                    <h3 style="margin-bottom: 10px;">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ñ–∏–ª–∏–∞–ª–æ–≤</h3>
                    <p>–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
                    <p style="font-size: 11px; margin-top: 10px;">–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞</p>
                </div>
            </div>
        </div>
        
        <div class="version-badge">v4.0 | –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π | GitHub Pages</div>
    </div>
    
    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // –ö–û–ù–°–¢–ê–ù–¢–´
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        const API_URL = 'https://script.google.com/macros/s/AKfycbwyjWBnlCZFMbjkcggsMQWuhaxUzNkxG2_QStfSqf3sSoeNlkF424ykPbrxgwtg2sA/exec';
        
        let currentData = null;
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        window.onload = function() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
            const now = new Date();
            const currentMonth = now.getMonth() + 1;
            document.getElementById('monthSelect').value = currentMonth;
            document.getElementById('monthSelectFilials').value = currentMonth;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            loadData();
        };
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // TAB SWITCHING
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            if (tabName === 'overview') {
                tabs[0].classList.add('active');
                tabContents[0].classList.add('active');
            } else if (tabName === 'filials') {
                tabs[1].classList.add('active');
                tabContents[1].classList.add('active');
            } else if (tabName === 'analytics') {
                tabs[2].classList.add('active');
                tabContents[2].classList.add('active');
            }
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // LOAD DATA
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        async function loadData() {
            const month = document.getElementById('monthSelect').value;
            document.getElementById('monthSelectFilials').value = month;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('overview-loading').style.display = 'block';
            document.getElementById('overview-content').style.display = 'none';
            document.getElementById('overview-error').style.display = 'none';
            document.getElementById('filials-loading').style.display = 'block';
            document.getElementById('filials-content').style.display = 'none';
            document.getElementById('filials-error').style.display = 'none';
            
            try {
                const response = await fetch(`${API_URL}?month=${month}`);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                currentData = data;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±–∑–æ—Ä
                updateOverview(data);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∏–ª–∏–∞–ª—ã
                updateFilials(data);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                document.getElementById('overview-loading').style.display = 'none';
                document.getElementById('overview-content').style.display = 'block';
                document.getElementById('filials-loading').style.display = 'none';
                document.getElementById('filials-content').style.display = 'block';
                
            } catch (err) {
                console.error('Error loading data:', err);
                
                document.getElementById('overview-loading').style.display = 'none';
                document.getElementById('overview-error').style.display = 'block';
                document.getElementById('overview-error').innerHTML = `
                    <div class="error-message">
                        <strong>‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</strong><br>
                        ${err.message}<br><br>
                        –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.
                    </div>
                `;
                
                document.getElementById('filials-loading').style.display = 'none';
                document.getElementById('filials-error').style.display = 'block';
                document.getElementById('filials-error').innerHTML = `
                    <div class="error-message">
                        <strong>‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</strong><br>
                        ${err.message}
                    </div>
                `;
            }
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UPDATE OVERVIEW
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function updateOverview(data) {
            const totals = data.totals;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—ã
            document.getElementById('totalAtelie').textContent = formatNumber(totals.fact.atelie);
            document.getElementById('totalHimchistka').textContent = formatNumber(totals.fact.himchistka);
            document.getElementById('totalRevenue').textContent = formatNumber(totals.fact.total);
            document.getElementById('totalClients').textContent = totals.fact.clients.toLocaleString('ru-RU');
            document.getElementById('totalProfit').textContent = formatNumber(totals.fact.profit);
            
            // –ü–ª–∞–Ω—ã
            if (totals.plan.total > 0) {
                document.getElementById('totalAteliePlan').textContent = 
                    `–ü–ª–∞–Ω: ${formatNumber(totals.plan.atelie)} (${totals.performance.atelie}%)`;
                document.getElementById('totalHimchistkaPlan').textContent = 
                    `–ü–ª–∞–Ω: ${formatNumber(totals.plan.himchistka)} (${totals.performance.himchistka}%)`;
                document.getElementById('totalRevenuePlan').textContent = 
                    `–ü–ª–∞–Ω: ${formatNumber(totals.plan.total)} (${totals.performance.total}%)`;
            }
            
            // –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
            if (totals.fact.avgCheck) {
                document.getElementById('avgCheck').textContent = 
                    `–°—Ä–µ–¥–Ω–∏–π —á–µ–∫: ${formatNumber(totals.fact.avgCheck)}`;
            }
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            const progressPercent = totals.performance ? totals.performance.total : 0;
            document.getElementById('totalProgress').style.width = Math.min(progressPercent, 100) + '%';
            document.getElementById('totalProgress').textContent = progressPercent + '%';
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UPDATE FILIALS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function updateFilials(data) {
            const grid = document.getElementById('filialsGrid');
            grid.innerHTML = '';
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ–±—â–µ–º—É –æ–±–æ—Ä–æ—Ç—É
            const sortedFilials = [...data.filials].sort((a, b) => b.fact.total - a.fact.total);
            
            sortedFilials.forEach((filial, index) => {
                const rank = index + 1;
                const card = createFilialCard(filial, rank, data.currentMonth);
                grid.appendChild(card);
            });
        }
        
        function createFilialCard(filial, rank, currentMonth) {
            const card = document.createElement('div');
            card.className = 'filial-card';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            let perfClass = 'low';
            let perfEmoji = 'üî¥';
            if (filial.performance.total >= 95) {
                perfClass = 'high';
                perfEmoji = 'üü¢';
            } else if (filial.performance.total >= 85) {
                perfClass = 'medium';
                perfEmoji = 'üü°';
            }
            
            let forecastHtml = '';
            if (filial.forecast) {
                let probEmoji = '‚ùì';
                let probText = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                if (filial.forecast.probability === 'high') {
                    probEmoji = 'üü¢';
                    probText = '–í—ã—Å–æ–∫–∞—è';
                } else if (filial.forecast.probability === 'medium') {
                    probEmoji = 'üü°';
                    probText = '–°—Ä–µ–¥–Ω—è—è';
                } else if (filial.forecast.probability === 'low') {
                    probEmoji = 'üî¥';
                    probText = '–ù–∏–∑–∫–∞—è';
                }
                
                forecastHtml = `
                    <div class="forecast-box">
                        <div class="title">üéØ –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –∫–æ–Ω–µ—Ü –º–µ—Å—è—Ü–∞</div>
                        <div style="margin-top: 5px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>–ü—Ä–æ–≥–Ω–æ–∑:</span>
                                <strong>${formatNumber(filial.forecast.total)}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 3px;">
                                <span>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:</span>
                                <strong>${probEmoji} ${probText}</strong>
                            </div>
                            <div style="margin-top: 5px; font-size: 10px; color: #999;">
                                –î–Ω–µ–π –ø—Ä–æ—à–ª–æ: ${filial.forecast.daysPassed} | –û—Å—Ç–∞–ª–æ—Å—å: ${filial.forecast.daysLeft}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            card.innerHTML = `
                <div class="filial-header">
                    <div class="filial-name">${filial.name}</div>
                    <div class="filial-rank">#${rank}</div>
                </div>
                
                <div class="filial-metrics">
                    <div class="metric-row">
                        <span class="metric-label">–ê—Ç–µ–ª—å–µ:</span>
                        <span class="metric-value">${formatNumber(filial.fact.atelie)}</span>
                    </div>
                    <div class="metric-plan">
                        –ü–ª–∞–Ω: ${formatNumber(filial.plan.atelie)} (${filial.performance.atelie}%)
                    </div>
                    
                    <div class="metric-row" style="margin-top: 8px;">
                        <span class="metric-label">–•–∏–º—á–∏—Å—Ç–∫–∞:</span>
                        <span class="metric-value">${formatNumber(filial.fact.himchistka)}</span>
                    </div>
                    <div class="metric-plan">
                        –ü–ª–∞–Ω: ${formatNumber(filial.plan.himchistka)} (${filial.performance.himchistka}%)
                    </div>
                    
                    <div class="metric-row" style="margin-top: 8px;">
                        <span class="metric-label">–ò–¢–û–ì–û:</span>
                        <span class="metric-value">${formatNumber(filial.fact.total)}</span>
                    </div>
                    <div class="metric-plan">
                        –ü–ª–∞–Ω: ${formatNumber(filial.plan.total)}
                    </div>
                </div>
                
                <div class="performance-indicator ${perfClass}">
                    ${perfEmoji} ${filial.performance.total}% –æ—Ç –ø–ª–∞–Ω–∞
                </div>
                
                <div class="clients-info">
                    <div>
                        <span>üë• –ö–ª–∏–µ–Ω—Ç—ã:</span>
                        <strong>${filial.fact.clients}</strong>
                    </div>
                    <div>
                        <span>üí∞ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫:</span>
                        <strong>${formatNumber(filial.fact.avgCheck)}</strong>
                    </div>
                    <div>
                        <span>‚úÖ –ü—Ä–∏–±—ã–ª—å:</span>
                        <strong>${formatNumber(filial.fact.profit)}</strong>
                    </div>
                </div>
                
                ${forecastHtml}
            `;
            
            return card;
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UTILITY FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function formatNumber(num) {
            if (!num) return '0‚ÇΩ';
            return new Intl.NumberFormat('ru-RU').format(Math.round(num)) + '‚ÇΩ';
        }
    </script>
</body>
</html>
